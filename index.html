<html>
    <head>
        <h3>Cameron Kull, cak264 & Marie Williams, mcw242</h3>
        <script src="https://d3js.org/d3.v7.min.js"></script>

        <style>
            /* note: adjust width here to change change dimensions */
            .image {
              display: block;
              width: 100%;
              height: auto;
            }

            .top {
              position: absolute;
              top: 0;
              left: 0;
            }

            .container {
              position: relative;
              width: 830px;
              left: 150px;
              top: 30px;
            }

            #labels {
                float: left;
            }

            #first {
                position: fixed;
                top: 295px;
                left: 50px;
            }

            #second {
                position: fixed;
                top: 330px;
                left: 34px;
            }

            #third {
                position: fixed;
                top: 380px;
                left: 43px;
            }

            h1 {
                position: absolute;
                z-index: 1;
                top: -40px;
                left: -125px;
            }
        </style>

    </head>
    <body>
        <div id="labels">
            <h4 id="first">First Class</h4>
            <h4 id="second">Second Class</h4>
            <h4 id="third">Third Class</h4>
        </div>
        <div class="container">
            <h1>A Look at Titanic Passengers</h1>
            <img src="titanic.jpg" alt="Titanic sinking ship" height="500" class="image">
            <svg id="mainsvg" height="600" width="900" class="top"></svg>
        </div>
    </body>
    <script>
        const boatsvg = d3.select("svg#mainsvg");
        const width = boatsvg.attr('width');
        const height = boatsvg.attr('height');
        const margins = { "top": 10, "right": 10, "bottom": 40, "left": 40};
        const chartWidth = width - margins.left - margins.right;
        const chartHeight = height - margins.top - margins.bottom;
        const boat = boatsvg.append("g");


         let requestData = async function(){
            let passengers = await d3.csv("titanic-passenger-list.csv", d3.autoType);
            passengers = passengers.filter(p=> p.age != null && p.raw_fare != null);
            passengers = passengers.slice().sort((a,b) => d3.ascending(a.fare, b.fare));
            console.log(passengers);

            // group the passengers by class
            let firstDict = {};
            let secondDict = {};
            let thirdDict = {};

            //making lists so we can use the indices later
            let firstList = []
            let secondList = []
            let thirdList = []

            passengers.forEach((passenger, i) => {
                if (passenger.pclass == 1){
                    firstList.push(passenger)
                    firstDict[i]=passenger;
                }
                else if (passenger.pclass == 2){
                    secondList.push(passenger)
                    secondDict[i]=passenger;
                }
                else{
                    thirdList.push(passenger)
                    thirdDict[i]=passenger;
                };
            })

            //now the indices should be matched up
            firstList.sort((a, b) => a.raw_fare - b.raw_fare);
            secondList.sort((a, b) => a.raw_fare - b.raw_fare);
            thirdList.sort((a, b) => a.raw_fare - b.raw_fare);

            console.log(firstList);
            console.log(secondList);
            console.log(thirdList);

            // console.log(Object.keys(firstDict).length);
            // console.log(Object.keys(secondDict).length);
            // console.log(Object.keys(thirdDict).length);

            // console.log(firstDict);
            // console.log(secondDict);
            // console.log(thirdDict);


            //first class points
            let NumCols1 = 95;
            let ColSize1 = 3;
            let Width1 = 590;
            let Height1 = 15;

            const xScale1 = d3.scaleLinear().domain([0, NumCols1-1]).range([5, 18700]);
            const yScale1 = d3.scaleLinear().domain([0, ColSize1-1]).range([Height1, 5]);


            var firstG = boat.append("g")
                .attr("class", "firstClass")
                .attr("transform", "translate(105,236) rotate(-7.2)");

            firstG.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", Width1)
                .attr("height", Height1)
                .attr("fill", "none");

            firstG.selectAll("circle").data(firstList)
                .join("circle")
                .attr("class", "first")
                .attr("cx", (d,i) => xScale1(i/NumCols1))
                .attr("cy", (d,i) => yScale1(i%ColSize1))
                .attr("r", 1.8)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList1 = firstList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            firstG.selectAll("text").data(filteredList1)
                .join("text")
                .attr("class", "firstX")
                .attr("x", d => xScale1(d.originalIndex/NumCols1))
                .attr("y", d => yScale1(d.originalIndex%ColSize1))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 10)
                .attr("fill", "black");



            //second class points
            let NumCols2 = 87;
            let ColSize2 = 3;
            let Width2 = 808;
            let Height2 = 23;

            const xScale2 = d3.scaleLinear().domain([0, NumCols2-1]).range([0, 23300]);
            const yScale2 = d3.scaleLinear().domain([0, ColSize2-1]).range([Height2+2, 10]);

            var secondG = boat.append("g")
                .attr("class", "secondClass")
                .attr("transform", "translate(6,266) rotate(-7.2)");

            secondG.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", Width2)
                .attr("height", Height2)
                .attr("fill", "none");

            secondG.selectAll("circle").data(secondList)
                .join("circle")
                .attr("class", "second")
                .attr("cx", (d,i) => xScale2(i/NumCols2))
                .attr("cy", (d,i) => yScale2(i%ColSize2))
                .attr("r", 2)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList2 = secondList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            secondG.selectAll("text").data(filteredList2)
                .join("text")
                .attr("class", "secondX")
                .attr("x", d => xScale2(d.originalIndex/NumCols2))
                .attr("y", d => yScale2(d.originalIndex%ColSize2))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 12)
                .attr("fill", "black");



            //third class points
            let NumCols3 = 63; //63, 8, 6050
            let ColSize3 = 8; //50, 10, 3850
            let Width3 = 783;
            let Height3 = 61;

            const xScale3 = d3.scaleLinear().domain([0, NumCols3-1]).range([0, 6180]);
            const yScale3 = d3.scaleLinear().domain([0, ColSize3-1]).range([Height3, 10]);

            var thirdG = boat.append("g")
                .attr("class", "thirdClass")
                .attr("transform", "translate(6,296) rotate(-7)");

            thirdG.append("rect")
                .attr("x", 0)
                .attr("y", 5)
                .attr("width", Width3+8)
                .attr("height", Height3-13)
                .attr("transform", "rotate(1)")
                .attr("fill", "white");

            thirdG.selectAll("circle").data(thirdList)
                .join("circle")
                .attr("class", "third")
                .attr("cx", (d,i) => xScale3(i/NumCols3))
                .attr("cy", (d,i) => yScale3(i%ColSize3))
                .attr("r", 2)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList3 = thirdList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            // console.log(filteredList3)

            thirdG.selectAll("text").data(filteredList3)
                .join("text")
                .attr("class", "thirdX")
                .attr("x", d => xScale3(d.originalIndex/NumCols3))
                .attr("y", d => yScale3(d.originalIndex%ColSize3))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 12)
                .attr("fill", "black");

            //slant left: .attr("cy", (d,i) => yScale3((i / NumCols3) - (i % ColSize3)))
            //slant right: .attr("cy", (d,i) => yScale3(i%ColSize3))


            // make bins to hold passengers
         };

         requestData();
    </script>
</html>
