<html>
    <head>
        <h3>Cameron Kull, cak264 & Marie Williams, mcw242</h3>
        <script src="https://d3js.org/d3.v7.min.js"></script>

        <style>
            /* note: adjust width here to change change dimensions */
            .image {
              display: block;
              width: 100%;
              height: auto;
            }

            .top {
              position: absolute;
              top: 0;
              left: 0;
            }

            .between {
                position: absolute;
                top: 450;
            }

            .container {
              position: relative;
              width: 830px;
              left: 150px;
              top: 30px;
            }

            .firstX, .secondX, .thirdX {
              pointer-events: none;
            }

            #labels {
                float: left;
            }

            #first {
                position: absolute;
                top: 295px;
                left: 33px;
            }

            #second {
                position: absolute;
                top: 330px;
                left: 33px;
            }

            #third {
                position: absolute;
                top: 380px;
                left: 33px;
            }

            .firstX, .secondX, .thirdX {
                pointer-events: none;
            }

            h1 {
                position: absolute;
                z-index: 1;
                top: -40px;
                left: -125px;
            }

            .tabs {
                position: absolute;
                width: 830px;
                left: 110px;
                top: 550px;
            }

            #tabsvg {
                position: absolute;
                left: 100px;
                top: 580px;
                background-color: #f0f0f0;
                border: 1px solid black;
                border-radius: 10px;
            }

            button {
                margin: 0px;
                float: left;
                font-size: 15px;
                padding: 5px;
            }

            button:hover, button:focus{
                background-color: #f0f0f0;
                outline: 0.5px solid black;
            }

            .gridlines line {
              stroke: #bbb;
            }

            .gridlines .domain {
              stroke: none;
            }

            #panel {
                height: 280px;
                width: 280px;
                position: absolute;
                left: 1000px;
                top: 120px;
                padding: 0 20 20 20;
                margin-left: 50px;
                border: 3px solid black;
            }

            .panel {
                margin-bottom: 0px;
                font-weight: normal;
            }

            .bold, h3.panel {
                font-weight: bold;
            }

            td {
                padding-left: 10px;
                margin: 8px;
            }

            p {
                font-style: italic;
                margin-top: 5px;
                padding-bottom: 10px;
            }

            table {
                margin-left:-10px;
            }

            #legend {
                height: 130px;
                width: 140px;
                position: absolute;
                left: 30px;
                top: 130px;
                border: 3px solid black;
                z-index: 1;
            }

        </style>

    </head>
    <body>
        <svg id='legend'></svg>
        <div id="labels">
            <h4 id="first">First Class</h4>
            <h4 id="second">Second Class</h4>
            <h4 id="third">Third Class</h4>
        </div>
        <div class="container">
            <h1>A Look at Titanic Passengers</h1>
            <img src="Titanic.jpg" alt="Titanic sinking ship" height="500" class="image">
            <svg id="mainsvg" height="600" width="900" class="top"></svg>
        </div>
        <div id="panel"></div>
        <div class="tabs">
            <button id="all-b" type="button">All Classes</button>
            <button id="first-b" type="button">First Class</button>
            <button id="second-b" type="button">Second Class</button>
            <button id="third-b" type="button">Third Class</button>
        </div>
        <svg id="tabsvg" height="600" width="1000"></svg>


        <svg class="between" width="1200" height="80">

          <line x1="120" y1="40" x2="1000" y2="40" stroke="black" stroke-width="2"/>

          <line x1="120" y1="40" x2="150" y2="20" stroke="black" stroke-width="2"/>
          <line x1="120" y1="40" x2="150" y2="60" stroke="black" stroke-width="2"/>

          <line x1="1000" y1="40" x2="970" y2="20" stroke="black" stroke-width="2"/>
          <line x1="1000" y1="40" x2="970" y2="60" stroke="black" stroke-width="2"/>

          <text x="105" y="70" font-size="14" fill="black" text-anchor="end">Lower Fares</text>
          <text x="1000" y="70" font-size="14" fill="black" text-anchor="start">Higher Fares</text>
        </svg>


    </body>
    <script>
        const boatsvg = d3.select("svg#mainsvg");
        const width = boatsvg.attr('width');
        const height = boatsvg.attr('height');
        const margins = { "top": 10, "right": 10, "bottom": 40, "left": 40};
        const chartWidth = width - margins.left - margins.right;
        const chartHeight = height - margins.top - margins.bottom;
        const boat = boatsvg.append("g");


         let requestData = async function(){
            let passengers = await d3.csv("titanic-passenger-list.csv", d3.autoType);
            passengers = passengers.filter(p=> p.age != null && p.raw_fare != null);
            passengers = passengers.slice().sort((a,b) => d3.ascending(a.fare, b.fare));
            console.log(passengers);

            // group the passengers by class
            let firstDict = {};
            let secondDict = {};
            let thirdDict = {};

            //making lists so we can use the indices later
            let firstList = []
            let secondList = []
            let thirdList = []

            passengers.forEach((passenger, i) => {
                if (passenger.pclass == 1){
                    firstList.push(passenger)
                    firstDict[i]=passenger;
                }
                else if (passenger.pclass == 2){
                    secondList.push(passenger)
                    secondDict[i]=passenger;
                }
                else{
                    thirdList.push(passenger)
                    thirdDict[i]=passenger;
                };
            })

            //now the indices should be matched up
            firstList.sort((a, b) => a.raw_fare - b.raw_fare);
            secondList.sort((a, b) => a.raw_fare - b.raw_fare);
            thirdList.sort((a, b) => a.raw_fare - b.raw_fare);

            console.log(firstList);
            console.log(secondList);
            console.log(thirdList);


            //first class points
            let NumCols1 = 95;
            let ColSize1 = 3;
            let Width1 = 590;
            let Height1 = 15;

            const xScale1 = d3.scaleLinear().domain([0, NumCols1-1]).range([5, 18700]);
            const yScale1 = d3.scaleLinear().domain([0, ColSize1-1]).range([Height1, 5]);


            var firstG = boat.append("g")
                .attr("class", "firstClass")
                .attr("transform", "translate(105,236) rotate(-7.2)");

            firstG.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", Width1)
                .attr("height", Height1)
                .attr("fill", "none");

            firstG.selectAll("circle").data(firstList)
                .join("circle")
                .attr("class", "first")
                .attr("cx", (d,i) => xScale1(i/NumCols1))
                .attr("cy", (d,i) => yScale1(i%ColSize1))
                .attr("r", 1.8)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList1 = firstList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            firstG.selectAll("text").data(filteredList1)
                .join("text")
                .attr("class", "firstX")
                .attr("x", d => xScale1(d.originalIndex/NumCols1))
                .attr("y", d => yScale1(d.originalIndex%ColSize1))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 8)
                .attr("fill", "black");



            //second class points
            let NumCols2 = 87;
            let ColSize2 = 3;
            let Width2 = 808;
            let Height2 = 23;

            const xScale2 = d3.scaleLinear().domain([0, NumCols2-1]).range([0, 23300]);
            const yScale2 = d3.scaleLinear().domain([0, ColSize2-1]).range([Height2+2, 10]);

            var secondG = boat.append("g")
                .attr("class", "secondClass")
                .attr("transform", "translate(6,266) rotate(-7.2)");

            secondG.append("rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", Width2)
                .attr("height", Height2)
                .attr("fill", "none");

            secondG.selectAll("circle").data(secondList)
                .join("circle")
                .attr("class", "second")
                .attr("cx", (d,i) => xScale2(i/NumCols2))
                .attr("cy", (d,i) => yScale2(i%ColSize2))
                .attr("r", 2)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList2 = secondList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            secondG.selectAll("text").data(filteredList2)
                .join("text")
                .attr("class", "secondX")
                .attr("x", d => xScale2(d.originalIndex/NumCols2))
                .attr("y", d => yScale2(d.originalIndex%ColSize2))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 12)
                .attr("fill", "black");



            //third class points
            let NumCols3 = 63; //63, 8, 6050
            let ColSize3 = 8; //50, 10, 3850
            let Width3 = 783;
            let Height3 = 61;

            const xScale3 = d3.scaleLinear().domain([0, NumCols3-1]).range([0, 6180]);
            const yScale3 = d3.scaleLinear().domain([0, ColSize3-1]).range([Height3, 10]);

            var thirdG = boat.append("g")
                .attr("class", "thirdClass")
                .attr("transform", "translate(6,296) rotate(-7)");

            thirdG.append("rect")
                .attr("x", 0)
                .attr("y", 5)
                .attr("width", Width3+8)
                .attr("height", Height3-13)
                .attr("transform", "rotate(1)")
                .attr("fill", "white");

            thirdG.selectAll("circle").data(thirdList)
                .join("circle")
                .attr("class", "third")
                .attr("cx", (d,i) => xScale3(i/NumCols3))
                .attr("cy", (d,i) => yScale3(i%ColSize3))
                .attr("r", 2)
                .style("fill", d => {return d.sex === "male" ? "lightblue" : "pink";});


            var filteredList3 = thirdList.map((item, index) => ({ item: item, originalIndex: index }))
                                        .filter(({ item }) => item.survived === 0);

            // console.log(filteredList3)

            thirdG.selectAll("text").data(filteredList3)
                .join("text")
                .attr("class", "thirdX")
                .attr("x", d => xScale3(d.originalIndex/NumCols3))
                .attr("y", d => yScale3(d.originalIndex%ColSize3))
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text("x")
                .attr("font-size", 12)
                .attr("fill", "black");

            //slant left: .attr("cy", (d,i) => yScale3((i / NumCols3) - (i % ColSize3)))
            //slant right: .attr("cy", (d,i) => yScale3(i%ColSize3))

            let allCircles = boat.selectAll("circle");

            allCircles.on("mouseover", function(event, d) {

                this.parentNode.appendChild(this);

                d3.select(this)
                    .transition().duration(100)
                    .attr("stroke","black")
                    .attr("stroke-width", function() {
                        return d3.select(this).classed("first") ? 1.5 : 2;
                    })
                    .attr('r', function() {
                        return d3.select(this).classed("first") ? 4 : 5;
                    });

                d3.selectAll('text')
                  .each(function() {
                    this.parentNode.appendChild(this);
                  });

                updatePanel(d);

            });

            allCircles.on("mouseout", function(event, d) {

              d3.select(this)
                .transition().duration(200)
                .attr("stroke","")
                .attr("stroke-width", 1)
                .attr('r',2);

              table.selectAll("tr").remove();

            });

            let panelHeader = d3.select("#panel").append("h3").attr("class","panel").text("Passenger Information");
            panelHeader.append("p").attr("class","panel").text("Hover over a passenger to learn more about them");
            let table = panelHeader.append("table");

            function updatePanel(row) {
                let rowCopy = Object.assign({},row);

                let keysToKeep = ['name', 'pclass', 'survived', 'sex', 'age', 'fare'];
                let keyMappings = {
                    'pclass': 'Class',
                    'survived': 'Survived',
                    'name': 'Name',
                    'sex': 'Sex',
                    'age': 'Age',
                    'fare': 'Fare'
                };

                let kvPairs = keysToKeep
                    .map(key => {
                        let value = rowCopy[key];
                        if (key === 'pclass') {
                            value = convertPclass(value);
                        }
                        else if (key === 'survived'){
                            value = convertSurvived(value);
                        }
                        return [keyMappings[key], value];
                    })
                    .filter(([key, value]) => value !== null);

                console.log(kvPairs);

                table.selectAll("tr").remove();

                let rows = table.selectAll("tr").data(kvPairs)
                    .enter()
                    .append("tr");

                rows.each(function(d) {
                    d3.select(this).append("td").attr("class", "bold").text(d[0]);
                    d3.select(this).append("td").text(d[1]);
                });

            }

            function convertPclass(value) {
                if (value === 1) {
                    return 'First';
                } else if (value === 2) {
                    return 'Second';
                } else if (value === 3) {
                    return 'Third';
                }
            }

            function convertSurvived(value) {
                if (value === 1) {
                    return 'Yes';
                } else {
                    return 'No';
                }
            }

            let legend = d3.select("#legend");
            legend.append("circle")
                .attr("cx", 35)
                .attr("cy", 50)
                .attr("r", 8)
                .attr("fill", "pink")
            legend.append("circle")
                .attr("cx", 35)
                .attr("cy", 75)
                .attr("r", 8)
                .attr("fill", "lightblue")
            legend.append("text")
                .attr("x", 42)
                .attr("y", 25)
                .attr("font-size", 18)
                .attr("font-weight", "bold")
                .text("Legend")
            legend.append("text")
                .attr("x", 65)
                .attr("y", 55)
                .attr("font-size", 16)
                .text("Female")
            legend.append("text")
                .attr("x", 65)
                .attr("y", 80)
                .attr("font-size", 16)
                .text("Male")
            legend.append("text")
                .attr("x", 28)
                .attr("y", 108)
                .attr("font-size", 18)
                .text("X")
            legend.append("text")
                .attr("x", 65)
                .attr("y", 107)
                .attr("font-size", 16)
                .text("Died")



            // setting up tabs
            let tabArea = d3.select("#tabsvg");

            let tabAll = tabArea.append("g")
                                .attr("class", "all");

            const tabWidth=500;
            const tabHeight=500;
            const tabMargins={top: 20, right: 20, bottom: 20, left: 30};
            const tabChartWidth = tabWidth - tabMargins.left - tabMargins.right;
            const tabChartHeight = tabHeight - tabMargins.top - tabMargins.bottom;

            let allChartArea=tabAll.append("g")
                            .attr("class", "allChartArea")
                            .attr("transform", `translate(${tabMargins.left}, ${tabMargins.top})`);


            // organizing data by age
            let bin = d3.bin().value(d=> d.age)
                              .thresholds([0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95]);

            let allAlive = passengers.filter(p=> p.survived == 1);
            let allDead = passengers.filter(p=> p.survived == 0);

            let allAliveBins = bin(allAlive);
            let allDeadBins = bin(allDead);

            // scales

            let allXScale = d3.scaleLinear().domain([0, 85]).range([0,tabChartWidth]);
            let aliveYScale = d3.scaleLinear().domain([0, d3.max(allDeadBins, function(d){return d.length})]).range([tabChartHeight/2, 0]);
            let deadYScale = d3.scaleLinear().domain([0, d3.max(allDeadBins, function(d){return d.length})]).range([tabChartHeight/2, tabChartHeight]);

            // axes

            let aliveLeftAxis = d3.axisLeft(aliveYScale);
            allChartArea.append('g')
                .attr('transform',`translate(${tabMargins.left-10},${tabMargins.top})`)
                .call(aliveLeftAxis);

            let deadLeftAxis = d3.axisLeft(deadYScale);
            allChartArea.append('g')
                .attr('transform',`translate(${tabMargins.left-10},${tabMargins.top})`)
                .call(deadLeftAxis);

            let aliveLeftGridlines = d3.axisLeft(aliveYScale)
                                .tickSize(-tabChartWidth-10)
                                .tickFormat('');
            allChartArea.append('g')
                .attr('class', 'gridlines')
                .attr('transform',`translate(${tabMargins.left-10},${tabMargins.top})`)
                .call(aliveLeftGridlines);

            let deadLeftGridlines = d3.axisLeft(deadYScale)
                                .tickSize(-tabChartWidth-10)
                                .tickFormat('');
            allChartArea.append('g')
                .attr('class', 'gridlines')
                .attr('transform',`translate(${tabMargins.left-10},${tabMargins.top})`)
                .call(deadLeftGridlines);

            let bottomAxis = d3.axisBottom(allXScale);
            allChartArea.append('g')
                .attr('transform',`translate(${tabMargins.left},${tabChartHeight+tabMargins.top+10})`)
                .call(bottomAxis);

            let bottomGridlines = d3.axisBottom(allXScale)
                    .tickSize(tabChartHeight+10)
                    .tickFormat('');
            allChartArea.append('g')
                .attr('class', 'gridlines')
                .attr('transform',`translate(${tabMargins.left},${tabMargins.top})`)
                .call(bottomGridlines);

            // axes labels
            let title = tabAll.append("text")
                              .attr("x", 240)
                              .attr("y", 30)
                              .text("All Passengers")
                              .style("font-size", 20);

            let xAxisTitle = tabAll.append("text")
                              .attr("x", 250)
                              .attr("y", 550)
                              .text("Passenger Age")
                              .style("font-size", 15);

            let yAlivetitle = tabAll.append("text")
                              .attr("x", -110)
                              .attr("y", 10)
                              .text("Survived")
                              .style('font-size', 15)
                              .attr("text-anchor", "end")
                              .attr("transform", "rotate(-90)")
                              .style("alignment-baseline", "central");

            let yDeadtitle = tabAll.append("text")
                              .attr("x", -350)
                              .attr("y", 10)
                              .text("Deceased")
                              .style('font-size', 15)
                              .attr("text-anchor", "end")
                              .attr("transform", "rotate(-90)")
                              .style("alignment-baseline", "central");

            let allDeadBars = allChartArea.append("g")
                                          .attr("transform", `translate(${tabMargins.left}, ${tabMargins.top})`);
            let allAliveBars = allChartArea.append("g")
                                          .attr("transform", `translate(${tabMargins.left}, ${tabMargins.top})`);

            allAliveBars.selectAll("rect").data(allAliveBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> aliveYScale(d.length))
                        .attr("height", d=> tabChartHeight/2-aliveYScale(d.length))
                        .attr("width", d=> (allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "steelblue")
                        .attr("stroke", "black");

            allDeadBars.selectAll("rect").data(allDeadBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> tabChartHeight/2)
                        .attr("height", d=> deadYScale(d.length)-tabChartHeight/2)
                        .attr("width", d=> (allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "grey")
                        .attr("stroke", "black");

            // pie charts
            let femalePassengers = passengers.filter(p=>p.sex=="female");
            let malePassengers = passengers.filter(p=>p.sex=="male");
            let pie = d3.pie().value(1).sort((a, b) => a.survived - b.survived);

            // labels

            let malePieTitle = tabAll.append("text")
                              .attr("x", 525)
                              .attr("y", 50)
                              .text("Male Passengers")
                              .style("font-size", 15);
            let femalePieTitle = tabAll.append("text")
                              .attr("x", 525)
                              .attr("y", 340)
                              .text("Female Passengers")
                              .style("font-size", 15);



            const malePie = pie(malePassengers);
            const femalePie = pie(femalePassengers);

            let malePieArea = tabAll.append("g")
                                    .attr("class", "male-pie")
                                    .attr('transform', `translate(${700}, ${150})`);

            malePieArea.selectAll('path').data(malePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 2);

            let femalePieArea = tabAll.append("g")
                                    .attr("class", "female-pie")
                                    .attr('transform', `translate(${700}, ${425})`);

            femalePieArea.selectAll('path').data(femalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 2);

            // first class

            let tabFirst = tabArea.append("g")
                                .attr("class", "first");

            let firstChartArea=tabFirst.append("g")
                            .attr("class", "chartArea")
                            .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            let firstAlive = firstList.filter(p=> p.survived == 1);
            let firstDead = firstList.filter(p=> p.survived == 0);

            let firstAliveBins = bin(firstAlive);
            let firstDeadBins = bin(firstDead);

            let firstDeadBars = firstChartArea.append("g").attr("visibility", "hidden")
                                              .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);
            let firstAliveBars = firstChartArea.append("g").attr("visibility", "hidden")
                                                .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            firstAliveBars.selectAll("rect").data(firstAliveBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> aliveYScale(d.length))
                        .attr("height", d=> tabChartHeight/2-aliveYScale(d.length))
                        .attr("width", d=>(allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "steelblue")
                        .attr("stroke", "black");

            firstDeadBars.selectAll("rect").data(firstDeadBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> tabChartHeight/2)
                        .attr("height", d=> deadYScale(d.length)-tabChartHeight/2)
                        .attr("width", d=> (allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "grey")
                        .attr("stroke", "black");
            // // pie charts
            let firstFemalePassengers = passengers.filter(p=>p.sex=="female" && p.pclass==1);
            let firstMalePassengers = passengers.filter(p=>p.sex=="male" && p.pclass==1);
            const firstMalePie = pie(firstMalePassengers);
            const firstFemalePie = pie(firstFemalePassengers);

            let firstMalePieArea = tabAll.append("g")
                                    .attr("class", "male-pie")
                                    .attr('transform', `translate(${700}, ${150})`)
                                    .attr("visibility", "hidden");

            firstMalePieArea.selectAll('path').data(firstMalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 4);

            let firstFemalePieArea = tabAll.append("g")
                                    .attr("class", "female-pie")
                                    .attr('transform', `translate(${700}, ${425})`)
                                    .attr("visibility", "hidden");

            firstFemalePieArea.selectAll('path').data(firstFemalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 4);

            // second class

            let tabSecond = tabArea.append("g")
                    .attr("class", "second");

            let secondChartArea=tabFirst.append("g")
                            .attr("class", "chartArea")
                            .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            let secondAlive = secondList.filter(p=> p.survived == 1);
            let secondDead = secondList.filter(p=> p.survived == 0);

            let secondAliveBins = bin(secondAlive);
            let secondDeadBins = bin(secondDead);

            let secondDeadBars = secondChartArea.append("g").attr("visibility", "hidden")
                                              .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);
            let secondAliveBars = secondChartArea.append("g").attr("visibility", "hidden")
                                                .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            secondAliveBars.selectAll("rect").data(secondAliveBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> aliveYScale(d.length))
                        .attr("height", d=> tabChartHeight/2-aliveYScale(d.length))
                        .attr("width", d=>(allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "steelblue")
                        .attr("stroke", "black");

            secondDeadBars.selectAll("rect").data(secondDeadBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> tabChartHeight/2)
                        .attr("height", d=> deadYScale(d.length)-tabChartHeight/2)
                        .attr("width", d=> (allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "grey")
                        .attr("stroke", "black");

            // pie charts
            let secondFemalePassengers = passengers.filter(p=>p.sex=="female" && p.pclass==2);
            let secondMalePassengers = passengers.filter(p=>p.sex=="male" && p.pclass==2);
            const secondMalePie = pie(secondMalePassengers);
            const secondFemalePie = pie(secondFemalePassengers);

            let secondMalePieArea = tabAll.append("g")
                                    .attr("class", "male-pie")
                                    .attr('transform', `translate(${700}, ${150})`)
                                    .attr("visibility", "hidden");

            secondMalePieArea.selectAll('path').data(secondMalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 4);

            let secondFemalePieArea = tabAll.append("g")
                                    .attr("class", "female-pie")
                                    .attr('transform', `translate(${700}, ${425})`)
                                    .attr("visibility", "hidden");

            secondFemalePieArea.selectAll('path').data(secondFemalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 5);


             // third class

            let tabThird = tabArea.append("g")
                    .attr("class", "second");

            let thirdChartArea=tabFirst.append("g")
                            .attr("class", "chartArea")
                            .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            let thirdAlive = thirdList.filter(p=> p.survived == 1);
            let thirdDead = thirdList.filter(p=> p.survived == 0);

            let thirdAliveBins = bin(thirdAlive);
            let thirdDeadBins = bin(thirdDead);

            let thirdDeadBars = thirdChartArea.append("g").attr("visibility", "hidden")
                                              .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);
            let thirdAliveBars = secondChartArea.append("g").attr("visibility", "hidden")
                                                .attr('transform', `translate(${tabMargins.left}, ${tabMargins.top})`);

            thirdAliveBars.selectAll("rect").data(thirdAliveBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> aliveYScale(d.length))
                        .attr("height", d=> tabChartHeight/2-aliveYScale(d.length))
                        .attr("width", d=>(allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "steelblue")
                        .attr("stroke", "black");

            thirdDeadBars.selectAll("rect").data(thirdDeadBins)
                        .join("rect")
                        .attr("x", function(d){
                            if (d.x0 % 5 !=0){return allXScale(d.x1-5)}
                            else{return allXScale(d.x0)};
                        })
                        .attr("y", d=> tabChartHeight/2)
                        .attr("height", d=> deadYScale(d.length)-tabChartHeight/2)
                        .attr("width", d=> (allXScale(d.x0 + 5)) - (allXScale(d.x0)))
                        .attr("fill", "grey")
                        .attr("stroke", "black");

            // pie charts
            let thirdFemalePassengers = passengers.filter(p=>p.sex=="female" && p.pclass==3);
            let thirdMalePassengers = passengers.filter(p=>p.sex=="male" && p.pclass==3);
            const thirdMalePie = pie(thirdMalePassengers);
            const thirdFemalePie = pie(thirdFemalePassengers);

            let thirdMalePieArea = tabAll.append("g")
                                    .attr("class", "male-pie")
                                    .attr('transform', `translate(${700}, ${150})`)
                                    .attr("visibility", "hidden");

            thirdMalePieArea.selectAll('path').data(thirdMalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 4);

            let thirdFemalePieArea = tabAll.append("g")
                                    .attr("class", "female-pie")
                                    .attr('transform', `translate(${700}, ${425})`)
                                    .attr("visibility", "hidden");

            thirdFemalePieArea.selectAll('path').data(thirdFemalePie)
                .join('path')
                .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(75)
                )
                .attr('stroke', p=> {
                                if(p.data.survived == 0){
                                    return "grey";
                                } else {
                                    return "steelblue";
                                }})
                .attr("stroke-width", 5);




            // count labels
            let maleAliveCountLabel = tabAll.append("text")
                                        .attr("x", 660)
                                        .attr("y", 115)
                                        .text(allAlive.filter(p=> p.sex == "male").length.toString())
                                        .style("font-size", 15)
                                        .style("font-weight", "bold");

            let maleDeadCountLabel = tabAll.append("text")
                                        .attr("x", 710)
                                        .attr("y", 185)
                                        .text(allDead.filter(p=> p.sex == "male").length.toString())
                                        .style("font-size", 15)
                                        .style("font-weight", "bold");

            let femaleAliveCountLabel = tabAll.append("text")
                                        .attr("x", 650)
                                        .attr("y", 445)
                                        .text(allAlive.filter(p=> p.sex == "female").length.toString())
                                        .style("font-size", 15)
                                        .style("font-weight", "bold");

            let femaleDeadCountLabel = tabAll.append("text")
                                        .attr("x", 720)
                                        .attr("y", 395)
                                        .text(allDead.filter(p=> p.sex == "female").length.toString())
                                        .style("font-size", 15)
                                        .style("font-weight", "bold");

            console.log()

            // interactivity

            let allButton = d3.select("#all-b");
            let firstButton = d3.select("#first-b");
            let secondButton = d3.select("#second-b");
            let thirdButton = d3.select("#third-b");

            allButton.on("click", function(){
                // all
                title.text("All Passengers").attr("x", 240);
                allAliveBars.attr("visibility", "visible");
                allDeadBars.attr("visibility", "visible");
                malePieArea.attr("visibility", "visible");
                femalePieArea.attr("visibility", "visible");

                // first
                firstAliveBars.attr("visibility", "hidden");
                firstDeadBars.attr("visibility", "hidden");
                firstMalePieArea.attr("visibility", "hidden");
                firstFemalePieArea.attr("visibility", "hidden");

                // second
                secondAliveBars.attr("visibility", "hidden");
                secondDeadBars.attr("visibility", "hidden");
                secondMalePieArea.attr("visibility", "hidden");
                secondFemalePieArea.attr("visibility", "hidden");

                // third
                thirdAliveBars.attr("visibility", "hidden");
                thirdDeadBars.attr("visibility", "hidden");
                thirdMalePieArea.attr("visibility", "hidden");
                thirdFemalePieArea.attr("visibility", "hidden");

                // counts
                maleAliveCountLabel.text(allAlive.filter(p=> p.sex == "male").length.toString())
                                    .attr("x", 660)
                                    .attr("y", 115);
                maleDeadCountLabel.text(allDead.filter(p=> p.sex == "male").length.toString());
                femaleAliveCountLabel.text(allAlive.filter(p=> p.sex == "female").length.toString());
                femaleDeadCountLabel.text(allDead.filter(p=> p.sex == "female").length.toString())
                                    .attr("x", 720)
                                    .attr("y", 395);
            })

            firstButton.on("click", function(){
                // all
                allAliveBars.attr("visibility", "hidden");
                allDeadBars.attr("visibility", "hidden");
                malePieArea.attr("visibility", "hidden");
                femalePieArea.attr("visibility", "hidden");

                // first
                title.text("First Class Passengers").attr("x", 220);
                firstAliveBars.attr("visibility", "visible");
                firstDeadBars.attr("visibility", "visible");
                firstMalePieArea.attr("visibility", "visible");
                firstFemalePieArea.attr("visibility", "visible");

                // second
                secondAliveBars.attr("visibility", "hidden");
                secondDeadBars.attr("visibility", "hidden");
                secondMalePieArea.attr("visibility", "hidden");
                secondFemalePieArea.attr("visibility", "hidden");

                // third
                thirdAliveBars.attr("visibility", "hidden");
                thirdDeadBars.attr("visibility", "hidden");
                thirdMalePieArea.attr("visibility", "hidden");
                thirdFemalePieArea.attr("visibility", "hidden");

                // counts
                maleAliveCountLabel.text(firstAlive.filter(p=> p.sex == "male").length.toString())
                                    .attr("x", 660)
                                    .attr("y", 115);
                maleDeadCountLabel.text(firstDead.filter(p=> p.sex == "male").length.toString());
                femaleAliveCountLabel.text(firstAlive.filter(p=> p.sex == "female").length.toString());
                femaleDeadCountLabel.text(firstDead.filter(p=> p.sex == "female").length.toString())
                                    .attr("x", 705)
                                    .attr("y", 365);
            })

            secondButton.on("click", function(){
                // all
                allAliveBars.attr("visibility", "hidden");
                allDeadBars.attr("visibility", "hidden");
                malePieArea.attr("visibility", "hidden");
                femalePieArea.attr("visibility", "hidden");

                // first
                firstAliveBars.attr("visibility", "hidden");
                firstDeadBars.attr("visibility", "hidden");
                malePieArea.attr("visibility", "hidden");
                femalePieArea.attr("visibility", "hidden");

                // second
                title.text("Second Class Passengers").attr("x", 220);
                secondAliveBars.attr("visibility", "visible");
                secondDeadBars.attr("visibility", "visible");
                secondMalePieArea.attr("visibility", "visible");
                secondFemalePieArea.attr("visibility", "visible");

                // third
                thirdAliveBars.attr("visibility", "hidden");
                thirdDeadBars.attr("visibility", "hidden");
                thirdMalePieArea.attr("visibility", "hidden");
                thirdFemalePieArea.attr("visibility", "hidden");

                // counts
                maleAliveCountLabel.text(secondAlive.filter(p=> p.sex == "male").length.toString())
                                    .attr("x", 670)
                                    .attr("y", 115);
                maleDeadCountLabel.text(secondDead.filter(p=> p.sex == "male").length.toString());
                femaleAliveCountLabel.text(secondAlive.filter(p=> p.sex == "female").length.toString());
                femaleDeadCountLabel.text(secondDead.filter(p=> p.sex == "female").length.toString())
                                    .attr("x", 715)
                                    .attr("y", 375);
            })

            thirdButton.on("click", function(){
                // all
                allAliveBars.attr("visibility", "hidden");
                allDeadBars.attr("visibility", "hidden");
                malePieArea.attr("visibility", "hidden");
                femalePieArea.attr("visibility", "hidden");

                // first
                firstAliveBars.attr("visibility", "hidden");
                firstDeadBars.attr("visibility", "hidden");
                firstMalePieArea.attr("visibility", "hidden");
                firstFemalePieArea.attr("visibility", "hidden");

                // second
                secondAliveBars.attr("visibility", "hidden");
                secondDeadBars.attr("visibility", "hidden");
                secondMalePieArea.attr("visibility", "hidden");
                secondFemalePieArea.attr("visibility", "hidden");

                // third
                title.text("Third Class Passengers").attr("x", 220);
                thirdAliveBars.attr("visibility", "visible");
                thirdDeadBars.attr("visibility", "visible");
                thirdMalePieArea.attr("visibility", "visible");
                thirdFemalePieArea.attr("visibility", "visible");

                // counts
                maleAliveCountLabel.text(thirdAlive.filter(p=> p.sex == "male").length.toString())
                                    .attr("x", 660)
                                    .attr("y", 115);
                maleDeadCountLabel.text(thirdDead.filter(p=> p.sex == "male").length.toString());
                femaleAliveCountLabel.text(thirdAlive.filter(p=> p.sex == "female").length.toString());
                femaleDeadCountLabel.text(thirdDead.filter(p=> p.sex == "female").length.toString())
                                    .attr("x", 725)
                                    .attr("y", 425);

            })

            // adding zooming

            // boatsvg.append("defs").append("clipPath")
            //           .attr("id","chartClip")
            //           .append("rect").attr("x",0)
            //                          .attr("y",0)
            //                          .attr("width",chartWidth)
            //                          .attr("height",chartHeight);

            // boat.attr("clip-path","url(#chartClip)");

            // // make an interactive "surface" at the top of the plot area
            // boatsvg.append("rect").attr("x",0).attr("y",0)
            //                     .attr("width",chartWidth).attr("height",chartHeight)
            //                     .attr("fill","none")
            //                     .style("pointer-events","all");

            // // 1. build a pan-zoom handler
            // let zoomExtent = [[0,0],[chartWidth,chartHeight]];
            // let translateExtent = [[-100, -100],[chartWidth+100,chartHeight+100]];
            // var plotZoom = d3.zoom()
            //                 .extent(zoomExtent)
            //                 .translateExtent(translateExtent)
            //                 .scaleExtent([1,10])
            //                 .on("zoom", plotZoomed);

            // // then add the zoom handler
            // boatsvg.call(plotZoom);

            // function plotZoomed( { transform } ) {
            //     console.log(transform);
            //     boatsvg.attr("transform", transform);
            // };

         };

         requestData();

    </script>
</html>
